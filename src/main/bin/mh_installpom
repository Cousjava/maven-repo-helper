#!/bin/bash

set -e

CLEAN_ARGS=''
SPEC=''

if [ "$1" = "-d" ]; then
    CLEAN_ARGS=$1
    shift
fi
if [ "$1" = "--debian-parent" ]; then
    CLEAN_ARGS=$1
    shift
fi
if [ "$1" = "-s" ]; then
    shift
    SPEC=$1
    shift
fi
if [ "$1" = "--spec" ]; then
    shift
    SPEC=$1
    shift
fi

PACKAGE=$1

if [ ! -z "${PACKAGE##-p}" ]; then
    PACKAGE=${PACKAGE##-p}
fi

POM=$2
INSTALLED_JAR=$3

if [ -z "$SPEC" ]; then
    if [ -f debian/maven.spec ]; then
        SPEC="debian/maven.spec"
    fi
fi

mkdir -p debian/tmp 2> /dev/null
mh_cleanpom $CLEAN_ARGS $POM debian/tmp/pom.xml debian/tmp/pom.properties debian/tmp/versions.properties $SPEC
source debian/tmp/pom.properties

GROUP_PATH=$(echo $GROUP_ID | tr . / )
mv debian/tmp/pom.xml debian/tmp/${ARTIFACT_ID}-${VERSION}.pom
dh_install -p${PACKAGE} --sourcedir=debian/tmp ${ARTIFACT_ID}-${VERSION}.pom \
	usr/share/maven-repo/${GROUP_PATH}/${ARTIFACT_ID}/${VERSION}

if [ ! -z "$INSTALLED_JAR" ]; then
	dh_link -p${PACKAGE} $INSTALLED_JAR \
		usr/share/maven-repo/${GROUP_PATH}/${ARTIFACT_ID}/${VERSION}/${ARTIFACT_ID}-${VERSION}.jar;
fi
